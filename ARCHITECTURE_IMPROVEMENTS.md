# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è Zeno Auth

–î–æ–∫—É–º–µ–Ω—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã.

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å–ª–æ–∏

- [x] **1.2. Bootstrap/DI –ø–∞–∫–µ—Ç** - `internal/bootstrap/bootstrap.go`
    - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
    - –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
    - –£–ø—Ä–æ—â–µ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ mock –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

### 2. Config –∏ ENV

- [x] **2.1. Config.Validate()** - `internal/config/validator.go`
    - –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
    - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –∑–Ω–∞—á–µ–Ω–∏–π (TTL, –ø–æ—Ä—Ç—ã)
    - –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (CORS wildcard –≤ production)
    - Fail-fast –ø—Ä–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

- [x] **2.2. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ENV** - `docs/ENV_VARIABLES.md`
    - –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º
    - –ü—Ä–∏–º–µ—Ä—ã –¥–ª—è dev/staging/production
    - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–∞–±–æ—Ç–µ —Å Secret Manager
    - –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 5. Observability

- [x] **5.1. Request ID middleware** - `internal/middleware/request_id.go`
    - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è/–ø—Ä–∏–µ–º X-Request-ID
    - –ü—Ä–æ–∫–∏–¥—ã–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ context
    - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Zerolog
    - –í–æ–∑–≤—Ä–∞—Ç –≤ response headers

### 4. –û—Ç–≤–µ—Ç—ã API

- [x] **4.1. –ï–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞** - `internal/response/response.go`
    - –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `{status, code, message, data}`
    - Helper —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö HTTP —Å—Ç–∞—Ç—É—Å–æ–≤
    - –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å API

### 9. Dev Experience

- [x] **9.1. –£–ª—É—á—à–µ–Ω–Ω—ã–π Makefile**
    - `make fmt` / `make fmt-strict` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    - `make cover` - coverage —Å HTML –æ—Ç—á–µ—Ç–æ–º
    - `make check` - –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑–æ–º
    - `make migrate-reset` - —Å–±—Ä–æ—Å –ë–î
    - `make migrate-create NAME=xxx` - —Å–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
    - `make install-tools` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ dev tools
    - `make staticcheck` - —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑

## üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å–ª–æ–∏

- [ ] **1.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–Ω–∏—Ü handler ‚Üí service ‚Üí repository**
    - –ê—É–¥–∏—Ç –≤—Å–µ—Ö handlers –Ω–∞ –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
    - –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

- [ ] **1.3. –°—Ç—Ä–æ–≥–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ context.Context**
    - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥–∞—á–∏ ctx –≤–æ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
    - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è ctx –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è—Ö
    - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–æ–≤ –≥–¥–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ

### 3. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- [ ] **3.2. JWT: issuer, audience, jti**
    - –î–æ–±–∞–≤–∏—Ç—å `iss`, `aud`, `jti` –≤ claims
    - –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ

- [ ] **3.3. JWKS endpoint**
    - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–ª—é—á–µ–π (kid)
    - Endpoint `/.well-known/jwks.json`
    - –†–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π

- [ ] **3.4. –ü–æ–ª–∏—Ç–∏–∫–∞ –ø–∞—Ä–æ–ª–µ–π**
    - –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
    - –£—Å–∏–ª–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é

- [ ] **3.5. Rate limiting –ø–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º**
    - –†–∞–∑–Ω—ã–µ –ª–∏–º–∏—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö endpoints
    - –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ JSON –æ—Ç–≤–µ—Ç—ã

### 4. –û—Ç–≤–µ—Ç—ã API

- [ ] **4.2. –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π mapping –æ—à–∏–±–æ–∫**
    - –î–æ—Ä–∞–±–æ—Ç–∞—Ç—å `internal/errors`
    - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–∞–ø–ø–∏–Ω–≥ domain errors ‚Üí HTTP

### 5. Observability

- [ ] **5.2. –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è –ª–æ–≥–æ–≤**
    - –ï–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
    - –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: user_id, org_id, ip, user_agent, request_id

- [ ] **5.3. Prometheus –º–µ—Ç—Ä–∏–∫–∏**
    - –≠–∫—Å–ø–æ—Ä—Ç –≤ Prometheus —Ñ–æ—Ä–º–∞—Ç
    - –ò–ª–∏ –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ OpenTelemetry

### 6. –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∏ –ë–î

- [ ] **6.1. –¢–∞–π–º–∞—É—Ç—ã –¥–ª—è –ë–î –∑–∞–ø—Ä–æ—Å–æ–≤**
    - `context.WithTimeout` –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
    - –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–¥–≤–∏—Å—à–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

- [ ] **6.2. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**
    - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    - GDPR –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö

- [ ] **6.3. Dev seed –¥–∞–Ω–Ω—ã–µ**
    - –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    - `make seed-dev`

### 7. HTTP/API

- [ ] **7.1. –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ API**
    - –ü—Ä–µ—Ñ–∏–∫—Å `/v1/` –¥–ª—è –≤—Å–µ—Ö endpoints
    - –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —ç–≤–æ–ª—é—Ü–∏–∏ API

- [ ] **7.2. OpenAPI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**
    - –ê–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è `api/openapi.yaml`
    - Swagger UI

- [ ] **7.3. CORS whitelist**
    - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `cfg.Server.CORSAllowedOrigins`
    - –†–∞–∑–Ω—ã–µ —Å–ø–∏—Å–∫–∏ –¥–ª—è dev/prod

### 8. –¢–µ—Å—Ç—ã

- [ ] **8.1. Unit-—Ç–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤**
    - AuthService, UserService, PasswordService
    - ConsentService, GDPRService
    - Happy path + edge cases

- [ ] **8.2. Unit-—Ç–µ—Å—Ç—ã –∫—Ä–∏–ø—Ç—ã**
    - PasswordManager
    - JWTManager

- [ ] **8.3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã**
    - docker-compose.test —Å Postgres
    - –¢–µ—Å—Ç—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤

### 9. Dev Experience

- [ ] **9.2. CI –ø–∞–π–ø–ª–∞–π–Ω**
    - GitHub Actions: test, vet, lint
    - Build Docker image
    - Deploy –Ω–∞ Cloud Run

### 10. –î–µ–ø–ª–æ–π

- [ ] **10.1. Health endpoints**
    - `/healthz` - liveness
    - `/readyz` - readiness —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ë–î

- [ ] **10.2. Graceful shutdown**
    - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Ñ–æ–Ω–æ–≤—ã—Ö –≥–æ—Ä—É—Ç–∏–Ω
    - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ ctx.Done()

- [ ] **10.3. Cloud Run –∫–æ–Ω—Ñ–∏–≥**
    - JSON –ª–æ–≥–∏ –≤ stdout
    - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è CPU/RAM
    - Min/max instances

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å bootstrap –≤ `internal/app/app.go`
2. –î–æ–±–∞–≤–∏—Ç—å request ID middleware –≤ router
3. –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å handlers –Ω–∞ unified response format
4. –î–æ–±–∞–≤–∏—Ç—å context timeouts –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
5. –ù–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã

**High Priority:**

- Context propagation (1.3)
- Database timeouts (6.1)
- Transactions (6.2)
- Error mapping (4.2)

**Medium Priority:**

- JWT improvements (3.2, 3.3)
- API versioning (7.1)
- Unit tests (8.1, 8.2)

**Low Priority:**

- OpenAPI docs (7.2)
- Dev seeds (6.3)
- CI improvements (9.2)

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:** 6/40 –∑–∞–¥–∞—á (15%)
- **–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∑–∞–¥–∞—á–∏:** 4/10 (40%)
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** 2/3 (67%)
