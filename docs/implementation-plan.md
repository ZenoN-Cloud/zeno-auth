# üöÄ Zeno Auth ‚Äî –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

–ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è ZenoN-Cloud –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.

## –≠—Ç–∞–ø 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ (30 –º–∏–Ω)

### 1.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```bash
# –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
mkdir -p cmd/auth
mkdir -p internal/{config,handler,service,repository,model,token}
mkdir -p migrations
mkdir -p api/proto
```

### 1.2 Go –º–æ–¥—É–ª—å –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```bash
go mod init github.com/ZenoN-Cloud/zeno-auth
```

–û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
- `github.com/jackc/pgx/v5` - PostgreSQL –¥—Ä–∞–π–≤–µ—Ä
- `github.com/golang-jwt/jwt/v5` - JWT —Ç–æ–∫–µ–Ω—ã
- `github.com/gin-gonic/gin` - HTTP —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- `golang.org/x/crypto` - Argon2id —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- `github.com/golang-migrate/migrate/v4` - –º–∏–≥—Ä–∞—Ü–∏–∏
- `github.com/joho/godotenv` - .env —Ñ–∞–π–ª—ã

## –≠—Ç–∞–ø 2: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (45 –º–∏–Ω)

### 2.1 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`internal/config/`)
- –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ dev/prod —Ä–µ–∂–∏–º–æ–≤

### 2.2 –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```env
DATABASE_URL=postgres://...
PORT=8080
JWT_PRIVATE_KEY=...
ENV=dev
```

### 2.3 Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `Dockerfile` –¥–ª—è Cloud Run
- `.dockerignore`

## –≠—Ç–∞–ø 3: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (60 –º–∏–Ω)

### 3.1 –ú–∏–≥—Ä–∞—Ü–∏–∏ (`migrations/`)
–°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü:
- `001_create_users.up.sql`
- `002_create_organizations.up.sql` 
- `003_create_org_memberships.up.sql`
- `004_create_refresh_tokens.up.sql`

### 3.2 –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (`internal/model/`)
- `User` struct
- `Organization` struct
- `OrgMembership` struct
- `RefreshToken` struct

### 3.3 –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (`internal/repository/`)
- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è –∫–∞–∂–¥–æ–π —Å—É—â–Ω–æ—Å—Ç–∏
- PostgreSQL —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å pgx
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î

## –≠—Ç–∞–ø 4: –¢–æ–∫–µ–Ω—ã –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (90 –º–∏–Ω)

### 4.1 JWT —Ç–æ–∫–µ–Ω—ã (`internal/token/`)
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ claims
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤
- JWKS endpoint –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ RSA/ES256

### 4.2 Refresh —Ç–æ–∫–µ–Ω—ã
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
- –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è
- –†–æ—Ç–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤

### 4.3 –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
- Argon2id —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª–µ–π

## –≠—Ç–∞–ø 5: –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (120 –º–∏–Ω)

### 5.1 Auth Service (`internal/service/auth.go`)
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (–ª–æ–≥–∏–Ω)
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- –õ–æ–≥–∞—É—Ç

### 5.2 User Service (`internal/service/user.go`)
- –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º–∏

### 5.3 Organization Service (`internal/service/org.go`)
- –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
- –†–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

## –≠—Ç–∞–ø 6: HTTP API (90 –º–∏–Ω)

### 6.1 Handlers (`internal/handler/`)
```
POST /auth/register
POST /auth/login  
POST /auth/refresh
POST /auth/logout
GET  /me
GET  /jwks
GET  /health
```

### 6.2 Middleware
- CORS
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è JWT
- Rate limiting

### 6.3 –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–ª—è request/response
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## –≠—Ç–∞–ø 7: –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (30 –º–∏–Ω)

### 7.1 Main (`cmd/auth/main.go`)
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
- –ó–∞–ø—É—Å–∫ HTTP —Å–µ—Ä–≤–µ—Ä–∞
- Graceful shutdown

### 7.2 Makefile
- –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞
- –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π

## –≠—Ç–∞–ø 8: CI/CD –∏ –¥–µ–ø–ª–æ–π (60 –º–∏–Ω)

### 8.1 GitHub Actions (`.github/workflows/`)
- `deploy.yml` - –æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞–π–ø–ª–∞–π–Ω
- –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞
- –î–µ–ø–ª–æ–π –≤ Cloud Run
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ dev/prod

### 8.2 GCP –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- Service accounts
- Secret Manager
- Cloud SQL –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- IAM –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

## –≠—Ç–∞–ø 9: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (90 –º–∏–Ω)

### 9.1 Unit —Ç–µ—Å—Ç—ã
- –¢–µ—Å—Ç—ã –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤
- –¢–µ—Å—Ç—ã –¥–ª—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
- –ú–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### 9.2 Integration —Ç–µ—Å—Ç—ã
- –¢–µ—Å—Ç—ã API endpoints
- –¢–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω–æ–π –ë–î
- Docker Compose –¥–ª—è —Ç–µ—Å—Ç–æ–≤

### 9.3 E2E —Ç–µ—Å—Ç—ã
- –ü–æ–ª–Ω—ã–π —Ñ–ª–æ—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏/–ª–æ–≥–∏–Ω–∞
- –¢–µ—Å—Ç—ã —Ç–æ–∫–µ–Ω–æ–≤
- –¢–µ—Å—Ç—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π

## –≠—Ç–∞–ø 10: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è (45 –º–∏–Ω)

### 10.1 API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- OpenAPI/Swagger —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è
- –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤

### 10.2 README
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–ø—É—Å–∫—É
- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è

### 10.3 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- Health check endpoint
- –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è Cloud Run
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

## –û–±—â–µ–µ –≤—Ä–µ–º—è: ~11 —á–∞—Å–æ–≤

## –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

1. **–î–µ–Ω—å 1 (4-5 —á–∞—Å–æ–≤):** –≠—Ç–∞–ø—ã 1-4 (–±–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –ë–î, —Ç–æ–∫–µ–Ω—ã)
2. **–î–µ–Ω—å 2 (4-5 —á–∞—Å–æ–≤):** –≠—Ç–∞–ø—ã 5-7 (–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, API, main)
3. **–î–µ–Ω—å 3 (2-3 —á–∞—Å–∞):** –≠—Ç–∞–ø—ã 8-10 (CI/CD, —Ç–µ—Å—Ç—ã, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)

## –í–µ—Ç–∫–∏ Git:

- `feature/init-project` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- `feature/database-models` - –ë–î –∏ –º–æ–¥–µ–ª–∏
- `feature/auth-service` - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `feature/api-handlers` - HTTP API
- `feature/cicd-setup` - CI/CD
- `develop` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- `main` - –ø—Ä–æ–¥–∞–∫—à–Ω

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–º–µ–Ω—Ç—ã:

‚ö†Ô∏è **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏ –∏–ª–∏ –ø–∞—Ä–æ–ª–∏
‚ö†Ô∏è **–ú–∏–≥—Ä–∞—Ü–∏–∏:** –í—Å–µ–≥–¥–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ dev –ø–µ—Ä–µ–¥ prod
‚ö†Ô∏è **–¢–æ–∫–µ–Ω—ã:** –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–æ—Ç–∞—Ü–∏—è refresh —Ç–æ–∫–µ–Ω–æ–≤
‚ö†Ô∏è **IAM:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

–ì–æ—Ç–æ–≤ –Ω–∞—á–∏–Ω–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é! üöÄ